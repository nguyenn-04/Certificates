name: Update Certificates

on:
    schedule:
        - cron: '*/1 * * * *' # Chạy mỗi phút
    push:
        branches:
            - main

jobs:
    update-certificates:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v2

            - name: Set up Python
              uses: actions/setup-python@v2
              with:
                  python-version: '3.x'

            - name: Install dependencies
              run: |
                  python -m pip install --upgrade pip
                  pip install gspread oauth2client

            - name: Run update script
              env:
                  GOOGLE_SHEETS_CREDENTIALS: ${{ secrets.GOOGLE_SHEETS_CREDENTIALS }}
              run: python update_certificates.py

            - name: Check index.html changes
              run: |
                  echo "Checking changes in index.html"
                  cat index.html

            - name: Commit changes
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
              run: |
                  git config --global user.name 'github-actions[bot]'
                  git config --global user.email 'github-actions[bot]@users.noreply.github.com'
                  git add index.html
                  git commit -m 'Update index.html from GitHub Actions' || echo "No changes to commit"
                  git push https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git HEAD:main
